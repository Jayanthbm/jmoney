{"version":3,"file":"static/js/487.467b8980.chunk.js","mappings":"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","sources":["pages/Settings/Settings.js"],"sourcesContent":["// src/pages/Settings/Settings.js\n\nimport \"./Settings.css\";\n\nimport * as MdIcons from \"react-icons/md\";\n\nimport { get, set } from \"idb-keyval\";\nimport {\n  getCategoryCachekeys,\n  getPayeeCacheKey,\n  getRelativeTime,\n  getSupabaseUserIdFromLocalStorage,\n} from \"../../utils\";\nimport { useCallback, useEffect, useState } from \"react\";\n\nimport AppLayout from \"../../components/Layouts/AppLayout\";\nimport { supabase } from \"../../supabaseClient\";\n\nconst LAST_REFRESHED_KEY = \"settings-last-refreshed\";\n\nconst Settings = () => {\n  const [categoryType, setCategoryType] = useState(\"Expense\");\n  const [expenseCategories, setExpenseCategories] = useState([]);\n  const [incomeCategories, setIncomeCategories] = useState([]);\n  const [payees, setPayees] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [syncing, setSyncing] = useState(false);\n  const [lastSynced, setLastSynced] = useState(null);\n\n  const { INCOME_CACHE_KEY, EXPENSE_CACHE_KEY } = getCategoryCachekeys();\n  const { PAYEE_CACHE_KEY } = getPayeeCacheKey();\n\n  const getVisibleLimit = useCallback(() => {\n    const width = window.innerWidth;\n    if (width < 768) return 6; // Mobile\n    if (width < 1024) return 9; // Tablet\n    return 12;\n  }, []);\n\n  const [visibleLimit, setVisibleLimit] = useState(getVisibleLimit());\n\n  useEffect(() => {\n    const handleResize = () => {\n      setVisibleLimit(getVisibleLimit());\n    };\n    window.addEventListener(\"resize\", handleResize);\n    return () => window.removeEventListener(\"resize\", handleResize);\n  }, [getVisibleLimit]);\n\n  const categoriesToShow =\n    categoryType === \"Expense\" ? expenseCategories : incomeCategories;\n\n  const [showAllCategories, setShowAllCategories] = useState(false);\n  const [showAllPayees, setShowAllPayees] = useState(false);\n\n  const visibleCategories = showAllCategories\n    ? categoriesToShow\n    : categoriesToShow.slice(0, visibleLimit);\n\n  const visiblePayees = showAllPayees ? payees : payees.slice(0, visibleLimit);\n\n  const fetchIfMissing = async (key, fetcher) => {\n    const cached = await get(key);\n    if (cached && cached.length > 0) {\n      return cached;\n    }\n    console.log(\"from supabase\");\n    const fresh = await fetcher();\n    await set(key, fresh);\n    return fresh;\n  };\n\n  const fetchData = useCallback(async () => {\n    setLoading(true);\n    const userId = getSupabaseUserIdFromLocalStorage();\n\n    const [expense, income, payeeList] = await Promise.all([\n      fetchIfMissing(EXPENSE_CACHE_KEY, async () => {\n        const { data } = await supabase\n          .from(\"categories\")\n          .select(\"*\")\n          .eq(\"type\", \"Expense\")\n          .order(\"name\", { ascending: true });\n        return data || [];\n      }),\n      fetchIfMissing(INCOME_CACHE_KEY, async () => {\n        const { data } = await supabase\n          .from(\"categories\")\n          .select(\"*\")\n          .eq(\"type\", \"Income\")\n          .order(\"name\", { ascending: true });\n        return data || [];\n      }),\n      fetchIfMissing(PAYEE_CACHE_KEY, async () => {\n        const { data } = await supabase\n          .from(\"payees\")\n          .select(\"*\")\n          .order(\"name\", { ascending: true });\n        return data || [];\n      }),\n    ]);\n\n    setExpenseCategories(expense);\n    setIncomeCategories(income);\n    setPayees(payeeList);\n\n    const last = localStorage.getItem(userId + \"_\" + LAST_REFRESHED_KEY);\n    if (last) {\n      setLastSynced(Number(last));\n    } else {\n      const now = Date.now();\n      localStorage.setItem(userId + \"_\" + LAST_REFRESHED_KEY, now);\n      setLastSynced(now);\n    }\n\n    setLoading(false);\n  }, [EXPENSE_CACHE_KEY, INCOME_CACHE_KEY, PAYEE_CACHE_KEY]);\n\n  const refreshData = useCallback(async () => {\n    setSyncing(true);\n    const userId = getSupabaseUserIdFromLocalStorage();\n    const [expenseData, incomeData, payeeData] = await Promise.all([\n      supabase\n        .from(\"categories\")\n        .select(\"*\")\n        .eq(\"type\", \"Expense\")\n        .order(\"name\", { ascending: true }),\n      supabase\n        .from(\"categories\")\n        .select(\"*\")\n        .eq(\"type\", \"Income\")\n        .order(\"name\", { ascending: true }),\n      supabase.from(\"payees\").select(\"*\").order(\"name\", { ascending: true }),\n    ]);\n\n    const expense = expenseData.data || [];\n    const income = incomeData.data || [];\n    const payees = payeeData.data || [];\n\n    await set(EXPENSE_CACHE_KEY, expense);\n    await set(INCOME_CACHE_KEY, income);\n    await set(PAYEE_CACHE_KEY, payees);\n\n    setExpenseCategories(expense);\n    setIncomeCategories(income);\n    setPayees(payees);\n\n    const now = Date.now();\n    localStorage.setItem(userId + \"_\" + LAST_REFRESHED_KEY, now);\n    setLastSynced(now);\n\n    setSyncing(false);\n  }, [EXPENSE_CACHE_KEY, INCOME_CACHE_KEY, PAYEE_CACHE_KEY]);\n\n  useEffect(() => {\n    fetchData();\n  }, [fetchData]);\n\n  const renderIcon = (iconName) => {\n    const Icon = MdIcons[iconName];\n    return Icon ? <Icon size={16} style={{ marginRight: 8 }} /> : null;\n  };\n\n  const handleClearAndLogout = async () => {\n    // Clear localStorage & sessionStorage\n    localStorage.clear();\n    sessionStorage.clear();\n\n    // Clear IndexedDB\n    indexedDB.databases().then((dbs) => {\n      dbs.forEach((db) => indexedDB.deleteDatabase(db.name));\n    });\n\n    // Clear cookies\n    document.cookie.split(\";\").forEach((c) => {\n      document.cookie = c\n        .replace(/^ +/, \"\")\n        .replace(/=.*/, \"=;expires=\" + new Date().toUTCString() + \";path=/\");\n    });\n\n    await supabase.auth.signOut();\n  };\n\n  return (\n    <AppLayout title=\"Settings\" loading={loading} onRefresh={refreshData}>\n      <div className=\"sync-status\">\n        {lastSynced && (\n          <small className=\"sync-time\">\n            {syncing && <MdIcons.MdSync className=\"syncing-icon\" />} Last\n            synced: {getRelativeTime(lastSynced)}\n          </small>\n        )}\n      </div>\n      <div className=\"settings-wrapper\">\n        {/* Categories */}\n        <div className=\"settings-section\">\n          <div className=\"settings-header\">\n            <h2>Categories</h2>\n            <div className=\"category-toggle\">\n              <button\n                className={categoryType === \"Expense\" ? \"active\" : \"\"}\n                onClick={() => setCategoryType(\"Expense\")}\n              >\n                Expense\n              </button>\n              <button\n                className={categoryType === \"Income\" ? \"active\" : \"\"}\n                onClick={() => setCategoryType(\"Income\")}\n              >\n                Income\n              </button>\n            </div>\n          </div>\n          <div className=\"category-grid\">\n            {visibleCategories?.map((category) => (\n              <div className=\"category-card\" key={category.id}>\n                {renderIcon(category.icon)}\n                <span>{category.name}</span>\n              </div>\n            ))}\n          </div>\n\n          {categoriesToShow?.length > visibleLimit && (\n            <button\n              className=\"show-more-btn\"\n              onClick={() => setShowAllCategories((prev) => !prev)}\n            >\n              {showAllCategories ? \"Show Less\" : \"Show More\"}\n            </button>\n          )}\n        </div>\n\n        {/* Payees */}\n        <div className=\"settings-section\">\n          <h2>Payees</h2>\n          <div className=\"payee-grid\">\n            {visiblePayees.map((payee) => (\n              <div className=\"payee-card\" key={payee.id}>\n                <img src={payee.logo} alt={payee.name} className=\"payee-logo\" />\n                <div className=\"payee-name\">{payee.name}</div>\n              </div>\n            ))}\n          </div>\n\n          {payees.length > visibleLimit && (\n            <button\n              className=\"show-more-btn\"\n              onClick={() => setShowAllPayees((prev) => !prev)}\n            >\n              {showAllPayees ? \"Show Less\" : \"Show More\"}\n            </button>\n          )}\n        </div>\n      </div>\n      <div className=\"settings-footer\">\n        <button className=\"clear-cache-btn\" onClick={handleClearAndLogout}>\n          Clear Cache and Logout\n        </button>\n      </div>\n    </AppLayout>\n  );\n};\n\nexport default Settings;\n"],"names":["LAST_REFRESHED_KEY","Settings","categoryType","setCategoryType","useState","expenseCategories","setExpenseCategories","incomeCategories","setIncomeCategories","payees","setPayees","loading","setLoading","syncing","setSyncing","lastSynced","setLastSynced","INCOME_CACHE_KEY","EXPENSE_CACHE_KEY","getCategoryCachekeys","PAYEE_CACHE_KEY","getPayeeCacheKey","getVisibleLimit","useCallback","width","window","innerWidth","visibleLimit","setVisibleLimit","useEffect","handleResize","addEventListener","removeEventListener","categoriesToShow","showAllCategories","setShowAllCategories","showAllPayees","setShowAllPayees","visibleCategories","slice","visiblePayees","fetchIfMissing","async","key","fetcher","cached","get","length","console","log","fresh","set","fetchData","userId","getSupabaseUserIdFromLocalStorage","expense","income","payeeList","Promise","all","data","supabase","from","select","eq","order","ascending","last","localStorage","getItem","Number","now","Date","setItem","refreshData","expenseData","incomeData","payeeData","renderIcon","iconName","Icon","MdIcons","_jsx","size","style","marginRight","_jsxs","AppLayout","title","onRefresh","children","className","getRelativeTime","onClick","map","category","icon","name","id","prev","payee","src","logo","alt","clear","sessionStorage","indexedDB","databases","then","dbs","forEach","db","deleteDatabase","document","cookie","split","c","replace","toUTCString","auth","signOut"],"sourceRoot":""}