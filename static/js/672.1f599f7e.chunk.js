"use strict";(self.webpackChunkjmoney=self.webpackChunkjmoney||[]).push([[672],{2024(t,e,a){a.d(e,{A:()=>s});var n=a(8695),o=a(5200),r=a(423),c=(a(5043),a(579));const i=t=>{let{title:e,showRefreshButton:a,onRefresh:n,disabled:i,onBack:s}=t;return(0,c.jsxs)("div",{className:"header-container",children:[(0,c.jsxs)("div",{className:"header-title-wrapper ".concat(s?"clickable":""),onClick:()=>{s&&s()},children:[s&&(0,c.jsx)("div",{className:"header-back-button",role:"button","aria-label":"Go back",children:(0,c.jsx)(r.m6W,{})}),(0,c.jsx)("div",{className:"header-title",children:e})]}),a&&(0,c.jsx)("button",{className:"refresh-button",onClick:n,disabled:i,"aria-label":"Refresh",children:(0,c.jsx)(o.jTZ,{className:"refresh-icon"})})]})},s=t=>{let{title:e,children:a,onRefresh:o,loading:r,onBack:s}=t;return(0,c.jsxs)("div",{className:"container",children:[(0,c.jsx)(i,{title:e,showRefreshButton:void 0!==o,onRefresh:o,disabled:r,onBack:s}),r?(0,c.jsx)(n.A,{}):(0,c.jsx)(c.Fragment,{children:a})]})}},4172(t,e,a){a.d(e,{NN:()=>l,XH:()=>i,ar:()=>u,rr:()=>s,xg:()=>d});var n=a(7540),o=a(9992),r=a(7077);const c="budgets_cache",i=async t=>{try{const e=await(0,n.Jt)(c)||[];return await(0,n.hZ)(c,[...e,t]),!0}catch(e){return console.log("Error in adding budget",e),!1}},s=async t=>{try{const e=(await(0,n.Jt)(c)||[]).map((e=>e.id===t.id?t:e));return await(0,n.hZ)(c,e),!0}catch(e){return console.log("Error in updating budget",e),!1}},l=async t=>{try{const e=(await(0,n.Jt)(c)||[]).filter((e=>e.id!==t));return await(0,n.hZ)(c,e),!0}catch(e){return console.log("Error in deleting budget",e),!1}},d=async function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=await(0,n.Jt)("budgets_cache");return e&&Array.isArray(e)&&!t||(e=await(0,o.Pg)()),e},u=async function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=await(0,n.Jt)("budgets_amount_map_cache"),o=localStorage.getItem("budgets_amount_map_cache_last_fetched");let c=!1;if((!o||Date.now()-o>144e5)&&(c=!0),!a||"object"!==typeof a||t||c){const t=(await d(e)).flatMap((t=>t.categories)),a=(await(0,r.r2)()).filter((e=>"Expense"===e.type&&t.includes(e.category_id)));if(0===a.length){const t={};return await(0,n.hZ)("budgets_amount_map_cache",t),t}const o=a.sort(((t,e)=>new Date(t.date)-new Date(e.date))),c=new Date(o[0].date),i=new Date,s={},l=new Date(c.getFullYear(),c.getMonth(),1);for(;l.getFullYear()<i.getFullYear()||l.getFullYear()===i.getFullYear()&&l.getMonth()<=i.getMonth();){const e=l.getFullYear(),a=l.getMonth();for(const n of t){const t="".concat(e,"_").concat(a,"_").concat(n);s[t]=0}l.setMonth(l.getMonth()+1)}for(const e of a){const t=new Date(e.date),a=t.getFullYear(),n=t.getMonth(),o="".concat(a,"_").concat(n,"_").concat(e.category_id);s[o]+=e.amount}return Object.keys(s).forEach((t=>{s[t]=parseFloat(s[t].toFixed(2))})),await(0,n.hZ)("budgets_amount_map_cache",s),localStorage.setItem("budgets_amount_map_cache_last_fetched",Date.now()),s}return a}},9278(t,e,a){a.d(e,{$x:()=>s,D:()=>c,Fr:()=>l,TO:()=>i});var n=a(7540),o=a(9992),r=a(6756);const c=async t=>{const{GOALS_CACHE_KEY:e}=(0,r.Af)(),a=[...await(0,n.Jt)(e)||[],t];await(0,n.hZ)(e,a)},i=async t=>{const{GOALS_CACHE_KEY:e}=(0,r.Af)(),a=(await(0,n.Jt)(e)||[]).map((e=>e.id===t.id?t:e));await(0,n.hZ)(e,a)},s=async t=>{const{GOALS_CACHE_KEY:e}=(0,r.Af)(),a=(await(0,n.Jt)(e)||[]).filter((e=>e.id!==t));await(0,n.hZ)(e,a)},l=async()=>{const{GOALS_CACHE_KEY:t}=(0,r.Af)();let e=await(0,n.Jt)(t);return e&&Array.isArray(e)||(e=await(0,o.vB)()),e}},7077(t,e,a){a.d(e,{$i:()=>s,FG:()=>l,Lk:()=>c,Z$:()=>d,r2:()=>i});var n=a(7540),o=a(6756);const r=()=>{const{TRANSACTION_DB_NAME:t}=(0,o.RW)();return(0,n.y$)(t,"transactions-store")},c=async t=>{const{LAST_TRANSACTION_FETCH:e}=(0,o.RW)(),a=r();for(const o of t)await(0,n.hZ)(o.id,o,a);localStorage.setItem(e,Date.now())},i=async()=>{const t=r(),e=await(0,n.HP)(t);return await Promise.all(e.map((e=>(0,n.Jt)(e,t))))},s=async()=>{const t=r(),e=await(0,n.HP)(t);await Promise.all(e.map((e=>(0,n.yH)(e,t))))},l=async t=>{const e=r();await(0,n.hZ)(t.id,t,e)},d=async t=>{const e=r();await(0,n.yH)(t,e)}},9992(t,e,a){a.d(e,{AF:()=>_,Js:()=>u,KK:()=>f,Pg:()=>w,Uw:()=>g,YJ:()=>A,_r:()=>d,aZ:()=>y,cR:()=>E,gi:()=>S,iN:()=>p,vB:()=>h,yY:()=>m});var n=a(9379),o=a(4172),r=a(9278),c=a(7077),i=a(7540),s=a(6756),l=a(466);const d=async()=>{const t=(0,s.rU)();if(!t)return[];let e=[],a=0,n=!0;for(;n;){const{data:o,error:r}=await l.N.rpc("get_user_transactions",{uid:t,search_term:"",limit_count:1e3,offset_count:a});if(r){console.error("Error fetching transactions:",r);break}if(0===o.length){n=!1;break}e=[...e,...o],a+=1e3}return await(0,c.$i)(),await(0,c.Lk)(e),e},u=async()=>{try{const t=await(0,c.r2)();if(t.length<1)return!0;const e=new Date(Math.max(...t.map((t=>new Date(t.transaction_timestamp).getTime())))),a=await(async()=>{const t=(0,s.rU)(),{data:e,error:a}=await l.N.from("transactions").select("transaction_timestamp").eq("user_id",t).order("transaction_timestamp",{ascending:!1}).limit(1);return a?(console.error("Error fetching max transaction timestamp:",a),null):e.length>0?e[0].transaction_timestamp:null})(),n=a?new Date(a):null;return!n||e<n}catch(t){return console.error("Error in needsTransactionSync:",t),!0}},_=async function(t,e){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{incomeCategories:n=[],expenseCategories:o=[],payees:r=[]}=a,i=[...n,...o].find((t=>t.id===e.category_id)),s=r.find((t=>t.id===e.payee_id)),d={id:t,amount:e.amount,description:e.description,transaction_timestamp:e.transaction_timestamp,category_id:e.category_id,category_name:(null===i||void 0===i?void 0:i.name)||"",category_icon:(null===i||void 0===i?void 0:i.icon)||"",payee_id:e.payee_id||null,payee_name:(null===s||void 0===s?void 0:s.name)||null,payee_logo:(null===s||void 0===s?void 0:s.logo)||null,type:(null===i||void 0===i?void 0:i.type)||"Expense",date:e.transaction_timestamp.split("T")[0],product_link:e.product_link||null};return await(0,c.FG)(d),l.N.from("transactions").update(e).eq("id",t).then((t=>{let{error:e}=t;e&&console.error("Supabase update failed:",e)})),d},g=async t=>{await(0,c.Z$)(t),l.N.from("transactions").delete().eq("id",t).then((t=>{let{error:e}=t;e&&console.error("Supabase delete failed:",e)}))},m=async function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{incomeCategories:a=[],expenseCategories:n=[],payees:o=[]}=e,r=[...a,...n].find((e=>e.id===t.category_id)),i=o.find((e=>e.id===t.payee_id)),d={id:crypto.randomUUID(),amount:t.amount,description:t.description,transaction_timestamp:t.transaction_timestamp,category_id:t.category_id,category_name:(null===r||void 0===r?void 0:r.name)||"",category_icon:(null===r||void 0===r?void 0:r.icon)||"",payee_id:t.payee_id||null,payee_name:(null===i||void 0===i?void 0:i.name)||null,payee_logo:(null===i||void 0===i?void 0:i.logo)||null,type:(null===r||void 0===r?void 0:r.type)||"Expense",date:t.transaction_timestamp.split("T")[0],user_id:(0,s.rU)()};return await(0,c.FG)(d),l.N.from("transactions").insert([{id:d.id,amount:d.amount,description:d.description,transaction_timestamp:d.transaction_timestamp,category_id:d.category_id,payee_id:d.payee_id,type:d.type,user_id:d.user_id}]).then((t=>{let{error:e}=t;e&&console.error("Supabase insert failed:",e)})),d},h=async()=>{const{GOALS_CACHE_KEY:t,GOALS_EXPIRY_KEY:e}=(0,s.Af)(),{data:a,error:n}=await l.N.from("goals").select("*");if(!n)return localStorage.setItem(e,Date.now()),await(0,i.yH)(t),await(0,i.hZ)(t,a),a;console.error("Error fetching goals:",n)},y=async t=>{const e={id:crypto.randomUUID(),user_id:(0,s.rU)(),name:t.name,logo:t.logo,goal_amount:parseFloat(t.goal_amount),current_amount:parseFloat(t.current_amount)||0,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()};return await(0,r.D)(e),l.N.from("goals").insert([e]).then((t=>{let{error:e}=t;e&&console.error("Supabase insert failed:",e)})),e},p=async t=>{const e=(0,n.A)((0,n.A)({},t),{},{updated_at:(new Date).toISOString()});return await(0,r.TO)(e),l.N.from("goals").update(e).eq("id",t.id).eq("user_id",t.user_id).then((t=>{let{error:e}=t;e&&console.error("Supabase update failed:",e)})),e},f=async t=>{const e=(0,s.rU)();await(0,r.$x)(t),l.N.from("goals").delete().eq("id",t).eq("user_id",e).then((t=>{let{error:e}=t;e&&console.error("Supabase delete failed:",e)}))},w=async()=>{const t="budgets_cache",{data:e,error:a}=await l.N.from("budgets").select("*");if(!a)return await(0,i.yH)(t),await(0,i.hZ)(t,e),e;console.error("Error fetching budgets:",a)},A=async t=>{const e={id:crypto.randomUUID(),user_id:(0,s.rU)(),name:t.name,amount:t.amount,interval:t.interval,start_date:t.start_date,categories:t.categories,logo:t.logo,created_at:(new Date).toISOString()};return await(0,o.XH)(e),l.N.from("budgets").insert([e]).then((t=>{let{error:e}=t;e&&console.error("Supabase insert failed:",e)})),e},E=async t=>(await(0,o.rr)((0,n.A)((0,n.A)({},t),{},{updated_at:(new Date).toISOString()})),l.N.from("budgets").update(t).eq("id",t.id).eq("user_id",t.user_id).then((t=>{let{error:e}=t;e&&console.error("Supabase update failed:",e)})),(0,n.A)((0,n.A)({},t),{},{updated_at:(new Date).toISOString()})),S=async t=>{const e=(0,s.rU)();await(0,o.NN)(t),l.N.from("budgets").delete().eq("id",t).eq("user_id",e).then((t=>{let{error:e}=t;e&&console.error("Supabase delete failed:",e)}))}},6756(t,e,a){a.d(e,{Hw:()=>p,Qm:()=>f,mC:()=>h,Ey:()=>b,hz:()=>F,Af:()=>C,Ly:()=>w,IH:()=>N,gs:()=>y,rU:()=>S,Wl:()=>E,RW:()=>O,gD:()=>A,SS:()=>Y,Wh:()=>D,sH:()=>v});var n=a(6720);const o="goals",r="last_goals_fetch",c="last_transaction_fetch",i="expense_categories",s="income_categories",l="payees",d="_choosen_category_ids";a(5043);var u=a(9992),_=a(4749),g=a(3536),m=a(579);const h=t=>{if("number"!==typeof t||isNaN(t))return"\u20b90";const e=t<0,a=Math.abs(t).toLocaleString("en-IN");return e?"-\u20b9".concat(a):"\u20b9".concat(a)},y=t=>{const e=Date.now()-t,a=Math.floor(e/6e4);if(a<1)return"just now";if(a<60)return"".concat(a," min").concat(a>1?"s":""," ago");const n=Math.floor(a/60);if(n<24)return"".concat(n," hour").concat(n>1?"s":""," ago");const o=Math.floor(n/24);return"".concat(o," day").concat(o>1?"s":""," ago")},p=()=>{const t=new Date,e=t.getDate(),a=new Date(t.getFullYear(),t.getMonth()+1,0).getDate(),n=a-e+1,o=(n/a*100).toFixed(0),r=new Date(t.getFullYear(),t.getMonth()+1,1).toLocaleString("en-US",{month:"short"});return{date:"".concat(r," 01"),today:e,days_in_month:a,remaining_days:n,remaining_days_percentage:Number(o)}};function f(t){return(0,_.GP)(new Date(t),"dd MMM yyyy")}const w=t=>{const e=new Date,a=e.getFullYear(),n=e.getMonth();return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"].slice(0,(t===a?n:11)+1).map(((t,e)=>({value:e,label:t})))},A=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2022;const e=[];for(let a=(new Date).getFullYear();a>=t;a--)e.push({value:a,label:a});return e},E=t=>["#0088FE","#00C49F","#FFBB28","#FF8042","#FF6B6B","#FFD93D","#6BCB77","#4D96FF","#845EC2","#FFC75F","#F9F871","#00C9A7","#C34A36","#B39CD0","#0081CF","#FF8066","#A0E7E5","#F7B801","#7DCE82","#3DCCC7","#A28089","#9D8189","#6A0572","#E4BAD4"].slice(0,t);function S(){for(let a=0;a<localStorage.length;a++){const n=localStorage.key(a);if(n.endsWith("-auth-token"))try{const e=localStorage.getItem(n);if(e){var t;const a=JSON.parse(e),n=null===a||void 0===a||null===(t=a.user)||void 0===t?void 0:t.id;if(n)return n}}catch(e){console.error("Failed to parse auth token for key: ".concat(n),e)}}return null}const v=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:36;const a=n[t];return a?(0,m.jsx)(a,{size:e}):null},b=t=>t?(0,_.GP)(new Date(t),"dd MMM yy hh:mm a"):"",D=async function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const e=S(),a="".concat(e,"_").concat(r),n=localStorage.getItem(a),o=Date.now(),c=!n||o-Number(n)>864e5;if(t||c){return await(0,u.vB)()}},C=()=>{const t=S();return{GOALS_CACHE_KEY:"".concat(t,"_").concat(o),GOALS_EXPIRY_KEY:"".concat(t,"_").concat(r)}},F=t=>{const e=S();return{INCOME_CACHE_KEY:"".concat(e,"_").concat(s),EXPENSE_CACHE_KEY:"".concat(e,"_").concat(i),CHOOSEN_CATEGORIES_CACHE_KEY:"".concat(e,"_").concat(d)}},N=()=>{const t=S();return{PAYEE_CACHE_KEY:"".concat(t,"_").concat(l)}},O=()=>{const t=S();return{LAST_TRANSACTION_FETCH:"".concat(t,"_").concat(c),TRANSACTION_DB_NAME:"transactions-db-".concat(t)}},Y=t=>{let e=t.sort(((t,e)=>new Date(e.date)-new Date(t.date))),a=(0,g.groupBy)(e,"date");return Object.keys(a).forEach((t=>{a[t]=a[t].sort(((t,e)=>new Date(e.transaction_timestamp)-new Date(t.transaction_timestamp)))})),a}}}]);
//# sourceMappingURL=672.1f599f7e.chunk.js.map