"use strict";(self.webpackChunkjmoney=self.webpackChunkjmoney||[]).push([[487],{9487(e,s,a){a.r(s),a.d(s,{default:()=>m});var t=a(6720),n=a(7540),c=a(6756),i=a(5043),o=a(2024),r=a(466),l=a(579);const d="settings-last-refreshed",m=()=>{const[e,s]=(0,i.useState)("Expense"),[a,m]=(0,i.useState)([]),[h,g]=(0,i.useState)([]),[u,x]=(0,i.useState)([]),[p,w]=(0,i.useState)(!0),[N,y]=(0,i.useState)(!1),[j,E]=(0,i.useState)(null),{INCOME_CACHE_KEY:S,EXPENSE_CACHE_KEY:v}=(0,c.hz)(),{PAYEE_CACHE_KEY:f}=(0,c.IH)(),C=(0,i.useCallback)((()=>{const e=window.innerWidth;return e<768?6:e<1024?9:12}),[]),[b,k]=(0,i.useState)(C());(0,i.useEffect)((()=>{const e=()=>{k(C())};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[C]);const I="Expense"===e?a:h,[_,D]=(0,i.useState)(!1),[L,A]=(0,i.useState)(!1),P=_?I:I.slice(0,b),q=L?u:u.slice(0,b),z=async(e,s)=>{const a=await(0,n.Jt)(e);if(a&&a.length>0)return a;console.log("from supabase");const t=await s();return await(0,n.hZ)(e,t),t},H=(0,i.useCallback)((async()=>{w(!0);const e=(0,c.rU)(),[s,a,t]=await Promise.all([z(v,(async()=>{const{data:e}=await r.N.from("categories").select("*").eq("type","Expense").order("name",{ascending:!0});return e||[]})),z(S,(async()=>{const{data:e}=await r.N.from("categories").select("*").eq("type","Income").order("name",{ascending:!0});return e||[]})),z(f,(async()=>{const{data:e}=await r.N.from("payees").select("*").order("name",{ascending:!0});return e||[]}))]);m(s),g(a),x(t);const n=localStorage.getItem(e+"_"+d);if(n)E(Number(n));else{const s=Date.now();localStorage.setItem(e+"_"+d,s),E(s)}w(!1)}),[v,S,f]),M=(0,i.useCallback)((async()=>{y(!0);const e=(0,c.rU)(),[s,a,t]=await Promise.all([r.N.from("categories").select("*").eq("type","Expense").order("name",{ascending:!0}),r.N.from("categories").select("*").eq("type","Income").order("name",{ascending:!0}),r.N.from("payees").select("*").order("name",{ascending:!0})]),i=s.data||[],o=a.data||[],l=t.data||[];await(0,n.hZ)(v,i),await(0,n.hZ)(S,o),await(0,n.hZ)(f,l),m(i),g(o),x(l);const h=Date.now();localStorage.setItem(e+"_"+d,h),E(h),y(!1)}),[v,S,f]);(0,i.useEffect)((()=>{H()}),[H]);const Y=e=>{const s=t[e];return s?(0,l.jsx)(s,{size:16,style:{marginRight:8}}):null};return(0,l.jsxs)(o.A,{title:"Settings",loading:p,onRefresh:M,children:[(0,l.jsx)("div",{className:"sync-status",children:j&&(0,l.jsxs)("small",{className:"sync-time",children:[N&&(0,l.jsx)(t.MdSync,{className:"syncing-icon"})," Last synced: ",(0,c.gs)(j)]})}),(0,l.jsxs)("div",{className:"settings-wrapper",children:[(0,l.jsxs)("div",{className:"settings-section",children:[(0,l.jsxs)("div",{className:"settings-header",children:[(0,l.jsx)("h2",{children:"Categories"}),(0,l.jsxs)("div",{className:"category-toggle",children:[(0,l.jsx)("button",{className:"Expense"===e?"active":"",onClick:()=>s("Expense"),children:"Expense"}),(0,l.jsx)("button",{className:"Income"===e?"active":"",onClick:()=>s("Income"),children:"Income"})]})]}),(0,l.jsx)("div",{className:"category-grid",children:null===P||void 0===P?void 0:P.map((e=>(0,l.jsxs)("div",{className:"category-card",children:[Y(e.icon),(0,l.jsx)("span",{children:e.name})]},e.id)))}),(null===I||void 0===I?void 0:I.length)>b&&(0,l.jsx)("button",{className:"show-more-btn",onClick:()=>D((e=>!e)),children:_?"Show Less":"Show More"})]}),(0,l.jsxs)("div",{className:"settings-section",children:[(0,l.jsx)("h2",{children:"Payees"}),(0,l.jsx)("div",{className:"payee-grid",children:q.map((e=>(0,l.jsxs)("div",{className:"payee-card",children:[(0,l.jsx)("img",{src:e.logo,alt:e.name,className:"payee-logo"}),(0,l.jsx)("div",{className:"payee-name",children:e.name})]},e.id)))}),u.length>b&&(0,l.jsx)("button",{className:"show-more-btn",onClick:()=>A((e=>!e)),children:L?"Show Less":"Show More"})]})]}),(0,l.jsx)("div",{className:"settings-footer",children:(0,l.jsx)("button",{className:"clear-cache-btn",onClick:async()=>{localStorage.clear(),sessionStorage.clear(),indexedDB.databases().then((e=>{e.forEach((e=>indexedDB.deleteDatabase(e.name)))})),document.cookie.split(";").forEach((e=>{document.cookie=e.replace(/^ +/,"").replace(/=.*/,"=;expires="+(new Date).toUTCString()+";path=/")})),await r.N.auth.signOut()},children:"Clear Cache and Logout"})})]})}}}]);
//# sourceMappingURL=487.c08be176.chunk.js.map