"use strict";(self.webpackChunkjmoney=self.webpackChunkjmoney||[]).push([[672],{2024:(e,t,a)=>{a.d(t,{A:()=>c});var n=a(8695),r=a(5200),o=a(423),i=(a(5043),a(579));const s=e=>{let{title:t,showRefreshButton:a,onRefresh:n,disabled:s,onBack:c}=e;return(0,i.jsxs)("div",{className:"header-container",children:[(0,i.jsxs)("div",{className:"header-title-wrapper "+(c?"clickable":""),onClick:()=>{c&&c()},children:[c&&(0,i.jsx)("div",{className:"header-back-button",role:"button","aria-label":"Go back",children:(0,i.jsx)(o.m6W,{})}),(0,i.jsx)("div",{className:"header-title",children:t})]}),a&&(0,i.jsx)("button",{className:"refresh-button",onClick:n,disabled:s,"aria-label":"Refresh",children:(0,i.jsx)(r.jTZ,{className:"refresh-icon"})})]})},c=e=>{let{title:t,children:a,onRefresh:r,loading:o,onBack:c}=e;return(0,i.jsxs)("div",{className:"container",children:[(0,i.jsx)(s,{title:t,showRefreshButton:void 0!==r,onRefresh:r,disabled:o,onBack:c}),o?(0,i.jsx)(n.A,{}):(0,i.jsx)(i.Fragment,{children:a})]})}},4172:(e,t,a)=>{a.d(t,{NN:()=>l,XH:()=>s,ar:()=>u,rr:()=>c,xg:()=>d});var n=a(7540),r=a(9992),o=a(7077);const i="budgets_cache",s=async e=>{try{const t=await(0,n.Jt)(i)||[];return await(0,n.hZ)(i,[...t,e]),!0}catch(t){return console.log("Error in adding budget",t),!1}},c=async e=>{try{const t=(await(0,n.Jt)(i)||[]).map((t=>t.id===e.id?e:t));return await(0,n.hZ)(i,t),!0}catch(t){return console.log("Error in updating budget",t),!1}},l=async e=>{try{const t=(await(0,n.Jt)(i)||[]).filter((t=>t.id!==e));return await(0,n.hZ)(i,t),!0}catch(t){return console.log("Error in deleting budget",t),!1}},d=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=await(0,n.Jt)("budgets_cache");return t&&Array.isArray(t)&&!e||(t=await(0,r.Pg)()),t},u=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=await(0,n.Jt)("budgets_amount_map_cache"),r=localStorage.getItem("budgets_amount_map_cache_last_fetched");let i=!1;if((!r||Date.now()-r>144e5)&&(i=!0),!a||"object"!==typeof a||e||i){const e=(await d(t)).flatMap((e=>e.categories)),a=(await(0,o.r2)()).filter((t=>"Expense"===t.type&&e.includes(t.category_id)));if(0===a.length){const e={};return await(0,n.hZ)("budgets_amount_map_cache",e),e}const r=a.sort(((e,t)=>new Date(e.date)-new Date(t.date))),i=new Date(r[0].date),s=new Date,c={},l=new Date(i.getFullYear(),i.getMonth(),1);for(;l.getFullYear()<s.getFullYear()||l.getFullYear()===s.getFullYear()&&l.getMonth()<=s.getMonth();){const t=l.getFullYear(),a=l.getMonth();for(const n of e){c[`${t}_${a}_${n}`]=0}l.setMonth(l.getMonth()+1)}for(const t of a){const e=new Date(t.date),a=`${e.getFullYear()}_${e.getMonth()}_${t.category_id}`;c[a]+=t.amount}return Object.keys(c).forEach((e=>{c[e]=parseFloat(c[e].toFixed(2))})),await(0,n.hZ)("budgets_amount_map_cache",c),localStorage.setItem("budgets_amount_map_cache_last_fetched",Date.now()),c}return a}},6756:(e,t,a)=>{a.d(t,{Hw:()=>p,Qm:()=>f,mC:()=>h,Ey:()=>b,hz:()=>F,Af:()=>C,Ly:()=>w,IH:()=>N,gs:()=>y,rU:()=>v,Wl:()=>S,RW:()=>$,gD:()=>E,SS:()=>O,Wh:()=>D,sH:()=>A});var n=a(6720);const r="goals",o="last_goals_fetch",i="last_transaction_fetch",s="expense_categories",c="income_categories",l="payees",d="_choosen_category_ids";a(5043);var u=a(9992),_=a(4749),g=a(3536),m=a(579);const h=e=>{if("number"!==typeof e||isNaN(e))return"\u20b90";const t=e<0,a=Math.abs(e).toLocaleString("en-IN");return t?`-\u20b9${a}`:`\u20b9${a}`},y=e=>{const t=Date.now()-e,a=Math.floor(t/6e4);if(a<1)return"just now";if(a<60)return`${a} min${a>1?"s":""} ago`;const n=Math.floor(a/60);if(n<24)return`${n} hour${n>1?"s":""} ago`;const r=Math.floor(n/24);return`${r} day${r>1?"s":""} ago`},p=()=>{const e=new Date,t=e.getDate(),a=new Date(e.getFullYear(),e.getMonth()+1,0).getDate(),n=a-t+1,r=(n/a*100).toFixed(0);return{date:`${new Date(e.getFullYear(),e.getMonth()+1,1).toLocaleString("en-US",{month:"short"})} 01`,today:t,days_in_month:a,remaining_days:n,remaining_days_percentage:Number(r)}};function f(e){return(0,_.GP)(new Date(e),"dd MMM yyyy")}const w=e=>{const t=new Date,a=t.getFullYear(),n=t.getMonth();return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"].slice(0,(e===a?n:11)+1).map(((e,t)=>({value:t,label:e})))},E=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2022;const t=[];for(let a=(new Date).getFullYear();a>=e;a--)t.push({value:a,label:a});return t},S=e=>["#0088FE","#00C49F","#FFBB28","#FF8042","#FF6B6B","#FFD93D","#6BCB77","#4D96FF","#845EC2","#FFC75F","#F9F871","#00C9A7","#C34A36","#B39CD0","#0081CF","#FF8066","#A0E7E5","#F7B801","#7DCE82","#3DCCC7","#A28089","#9D8189","#6A0572","#E4BAD4"].slice(0,e);function v(){for(let a=0;a<localStorage.length;a++){const n=localStorage.key(a);if(n.endsWith("-auth-token"))try{const t=localStorage.getItem(n);if(t){var e;const a=JSON.parse(t),n=null===a||void 0===a||null===(e=a.user)||void 0===e?void 0:e.id;if(n)return n}}catch(t){console.error(`Failed to parse auth token for key: ${n}`,t)}}return null}const A=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:36;const a=n[e];return a?(0,m.jsx)(a,{size:t}):null},b=e=>e?(0,_.GP)(new Date(e),"dd MMM yy hh:mm a"):"",D=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=`${v()}_${o}`,a=localStorage.getItem(t),n=Date.now(),r=!a||n-Number(a)>864e5;if(e||r){return await(0,u.vB)()}},C=()=>{const e=v();return{GOALS_CACHE_KEY:`${e}_${r}`,GOALS_EXPIRY_KEY:`${e}_${o}`}},F=e=>{const t=v();return{INCOME_CACHE_KEY:`${t}_${c}`,EXPENSE_CACHE_KEY:`${t}_${s}`,CHOOSEN_CATEGORIES_CACHE_KEY:`${t}_${d}`}},N=()=>({PAYEE_CACHE_KEY:`${v()}_${l}`}),$=()=>{const e=v();return{LAST_TRANSACTION_FETCH:`${e}_${i}`,TRANSACTION_DB_NAME:`transactions-db-${e}`}},O=e=>{let t=e.sort(((e,t)=>new Date(t.date)-new Date(e.date))),a=(0,g.groupBy)(t,"date");return Object.keys(a).forEach((e=>{a[e]=a[e].sort(((e,t)=>new Date(t.transaction_timestamp)-new Date(e.transaction_timestamp)))})),a}},7077:(e,t,a)=>{a.d(t,{$i:()=>c,FG:()=>l,Lk:()=>i,Z$:()=>d,r2:()=>s});var n=a(7540),r=a(6756);const o=()=>{const{TRANSACTION_DB_NAME:e}=(0,r.RW)();return(0,n.y$)(e,"transactions-store")},i=async e=>{const{LAST_TRANSACTION_FETCH:t}=(0,r.RW)(),a=o();for(const r of e)await(0,n.hZ)(r.id,r,a);localStorage.setItem(t,Date.now())},s=async()=>{const e=o(),t=await(0,n.HP)(e);return await Promise.all(t.map((t=>(0,n.Jt)(t,e))))},c=async()=>{const e=o(),t=await(0,n.HP)(e);await Promise.all(t.map((t=>(0,n.yH)(t,e))))},l=async e=>{const t=o();await(0,n.hZ)(e.id,e,t)},d=async e=>{const t=o();await(0,n.yH)(e,t)}},9278:(e,t,a)=>{a.d(t,{$x:()=>c,D:()=>i,Fr:()=>l,TO:()=>s});var n=a(7540),r=a(9992),o=a(6756);const i=async e=>{const{GOALS_CACHE_KEY:t}=(0,o.Af)(),a=[...await(0,n.Jt)(t)||[],e];await(0,n.hZ)(t,a)},s=async e=>{const{GOALS_CACHE_KEY:t}=(0,o.Af)(),a=(await(0,n.Jt)(t)||[]).map((t=>t.id===e.id?e:t));await(0,n.hZ)(t,a)},c=async e=>{const{GOALS_CACHE_KEY:t}=(0,o.Af)(),a=(await(0,n.Jt)(t)||[]).filter((t=>t.id!==e));await(0,n.hZ)(t,a)},l=async()=>{const{GOALS_CACHE_KEY:e}=(0,o.Af)();let t=await(0,n.Jt)(e);return t&&Array.isArray(t)||(t=await(0,r.vB)()),t}},9992:(e,t,a)=>{a.d(t,{AF:()=>u,Js:()=>d,KK:()=>p,Pg:()=>f,Uw:()=>_,YJ:()=>w,_r:()=>l,aZ:()=>h,cR:()=>E,gi:()=>S,iN:()=>y,vB:()=>m,yY:()=>g});var n=a(4172),r=a(9278),o=a(7077),i=a(7540),s=a(6756),c=a(466);const l=async()=>{const e=(0,s.rU)();if(!e)return[];let t=[],a=0,n=!0;for(;n;){const{data:r,error:o}=await c.N.rpc("get_user_transactions",{uid:e,search_term:"",limit_count:1e3,offset_count:a});if(o){console.error("Error fetching transactions:",o);break}if(0===r.length){n=!1;break}t=[...t,...r],a+=1e3}return await(0,o.$i)(),await(0,o.Lk)(t),t},d=async()=>{try{const e=await(0,o.r2)();if(e.length<1)return!0;const t=new Date(Math.max(...e.map((e=>new Date(e.transaction_timestamp).getTime())))),a=await(async()=>{const e=(0,s.rU)(),{data:t,error:a}=await c.N.from("transactions").select("transaction_timestamp").eq("user_id",e).order("transaction_timestamp",{ascending:!1}).limit(1);return a?(console.error("Error fetching max transaction timestamp:",a),null):t.length>0?t[0].transaction_timestamp:null})(),n=a?new Date(a):null;return!n||t<n}catch(e){return console.error("Error in needsTransactionSync:",e),!0}},u=async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{incomeCategories:n=[],expenseCategories:r=[],payees:i=[]}=a,s=[...n,...r].find((e=>e.id===t.category_id)),l=i.find((e=>e.id===t.payee_id)),d={id:e,amount:t.amount,description:t.description,transaction_timestamp:t.transaction_timestamp,category_id:t.category_id,category_name:(null===s||void 0===s?void 0:s.name)||"",category_icon:(null===s||void 0===s?void 0:s.icon)||"",payee_id:t.payee_id||null,payee_name:(null===l||void 0===l?void 0:l.name)||null,payee_logo:(null===l||void 0===l?void 0:l.logo)||null,type:(null===s||void 0===s?void 0:s.type)||"Expense",date:t.transaction_timestamp.split("T")[0],product_link:t.product_link||null};return await(0,o.FG)(d),c.N.from("transactions").update(t).eq("id",e).then((e=>{let{error:t}=e;t&&console.error("Supabase update failed:",t)})),d},_=async e=>{await(0,o.Z$)(e),c.N.from("transactions").delete().eq("id",e).then((e=>{let{error:t}=e;t&&console.error("Supabase delete failed:",t)}))},g=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{incomeCategories:a=[],expenseCategories:n=[],payees:r=[]}=t,i=[...a,...n].find((t=>t.id===e.category_id)),l=r.find((t=>t.id===e.payee_id)),d={id:crypto.randomUUID(),amount:e.amount,description:e.description,transaction_timestamp:e.transaction_timestamp,category_id:e.category_id,category_name:(null===i||void 0===i?void 0:i.name)||"",category_icon:(null===i||void 0===i?void 0:i.icon)||"",payee_id:e.payee_id||null,payee_name:(null===l||void 0===l?void 0:l.name)||null,payee_logo:(null===l||void 0===l?void 0:l.logo)||null,type:(null===i||void 0===i?void 0:i.type)||"Expense",date:e.transaction_timestamp.split("T")[0],user_id:(0,s.rU)()};return await(0,o.FG)(d),c.N.from("transactions").insert([{id:d.id,amount:d.amount,description:d.description,transaction_timestamp:d.transaction_timestamp,category_id:d.category_id,payee_id:d.payee_id,type:d.type,user_id:d.user_id}]).then((e=>{let{error:t}=e;t&&console.error("Supabase insert failed:",t)})),d},m=async()=>{const{GOALS_CACHE_KEY:e,GOALS_EXPIRY_KEY:t}=(0,s.Af)(),{data:a,error:n}=await c.N.from("goals").select("*");if(!n)return localStorage.setItem(t,Date.now()),await(0,i.yH)(e),await(0,i.hZ)(e,a),a;console.error("Error fetching goals:",n)},h=async e=>{const t={id:crypto.randomUUID(),user_id:(0,s.rU)(),name:e.name,logo:e.logo,goal_amount:parseFloat(e.goal_amount),current_amount:parseFloat(e.current_amount)||0,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()};return await(0,r.D)(t),c.N.from("goals").insert([t]).then((e=>{let{error:t}=e;t&&console.error("Supabase insert failed:",t)})),t},y=async e=>{const t={...e,updated_at:(new Date).toISOString()};return await(0,r.TO)(t),c.N.from("goals").update(t).eq("id",e.id).eq("user_id",e.user_id).then((e=>{let{error:t}=e;t&&console.error("Supabase update failed:",t)})),t},p=async e=>{const t=(0,s.rU)();await(0,r.$x)(e),c.N.from("goals").delete().eq("id",e).eq("user_id",t).then((e=>{let{error:t}=e;t&&console.error("Supabase delete failed:",t)}))},f=async()=>{const e="budgets_cache",{data:t,error:a}=await c.N.from("budgets").select("*");if(!a)return await(0,i.yH)(e),await(0,i.hZ)(e,t),t;console.error("Error fetching budgets:",a)},w=async e=>{const t={id:crypto.randomUUID(),user_id:(0,s.rU)(),name:e.name,amount:e.amount,interval:e.interval,start_date:e.start_date,categories:e.categories,logo:e.logo,created_at:(new Date).toISOString()};return await(0,n.XH)(t),c.N.from("budgets").insert([t]).then((e=>{let{error:t}=e;t&&console.error("Supabase insert failed:",t)})),t},E=async e=>(await(0,n.rr)({...e,updated_at:(new Date).toISOString()}),c.N.from("budgets").update(e).eq("id",e.id).eq("user_id",e.user_id).then((e=>{let{error:t}=e;t&&console.error("Supabase update failed:",t)})),{...e,updated_at:(new Date).toISOString()}),S=async e=>{const t=(0,s.rU)();await(0,n.NN)(e),c.N.from("budgets").delete().eq("id",e).eq("user_id",t).then((e=>{let{error:t}=e;t&&console.error("Supabase delete failed:",t)}))}}}]);
//# sourceMappingURL=672.2fe13daa.chunk.js.map